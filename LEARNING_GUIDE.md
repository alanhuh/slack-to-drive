# 🧠 AI 분류 학습 시스템 사용 가이드

이 가이드는 사용자 피드백을 기반으로 AI 분류 정확도를 향상시키는 학습 시스템 사용 방법을 설명합니다.

---

## 📋 목차

1. [개요](#개요)
2. [사용자 작업: 수동 재분류](#사용자-작업-수동-재분류)
3. [자동 학습 실행](#자동-학습-실행)
4. [검증 및 재분류](#검증-및-재분류)
5. [문제 해결](#문제-해결)

---

## 개요

### 학습 시스템이 하는 일

1. **데이터 수집**: 사용자가 수정한 분류와 원래 AI 분류를 비교
2. **패턴 학습**: Vision API 레이블, 텍스트 길이, 신뢰도 패턴 분석
3. **규칙 생성**: 학습된 패턴을 바탕으로 새로운 분류 규칙 생성
4. **자동 적용**: classificationRules.js 파일 자동 업데이트

### 예상 소요 시간

- **수동 재분류**: 1-2시간 (124개 파일)
- **학습 실행**: 5분
- **검증 및 재분류**: 10-15분
- **총 소요 시간**: 약 2-3시간

### 예상 개선도

- **기존 정확도**: 약 45-60%
- **학습 후 정확도**: 약 85-95%
- **개선도**: +30-50%

---

## 사용자 작업: 수동 재분류

### Step 1: Google Drive 열기

1. Google Drive에 접속
2. "AI_분류" 폴더로 이동
3. 다음 5개 카테고리 폴더 확인:
   - 캐릭터 일러스트 (단독)
   - 일러스트 (단체)
   - UI / 화면
   - 게임 스크린샷
   - 기타

### Step 2: 파일 확인 및 이동

각 카테고리 폴더를 열어서 잘못 분류된 파일을 찾습니다.

**잘못 분류 예시:**
```
현재 위치: "게임 스크린샷" 폴더
실제 내용: 캐릭터 단독 일러스트
→ "캐릭터 일러스트 (단독)" 폴더로 이동
```

### Step 3: 파일 이동 방법

**방법 1: 드래그 앤 드롭**
1. 잘못 분류된 파일 선택
2. 올바른 카테고리 폴더로 드래그
3. 이동 확인

**방법 2: 이동 메뉴**
1. 파일 우클릭
2. "이동" 선택
3. 올바른 카테고리 폴더 선택
4. "이동" 클릭

### Step 4: 전체 확인

모든 카테고리 폴더를 확인하여 파일들이 올바른 위치에 있는지 최종 확인합니다.

**확인 체크리스트:**
- [ ] 캐릭터 일러스트 (단독): 캐릭터 1인 중심 이미지
- [ ] 일러스트 (단체): 캐릭터 여러 명 또는 배경 중심
- [ ] UI / 화면: 인터페이스 디자인, 목업
- [ ] 게임 스크린샷: 실제 게임 플레이 화면
- [ ] 기타: 위 카테고리에 맞지 않는 파일

---

## 자동 학습 실행

수동 재분류가 완료되면 다음 명령어를 순서대로 실행합니다.

### Step 1: 학습 실행

```bash
node scripts/learn-from-corrections.js
```

**예상 출력:**
```
🧠 AI 분류 학습 시작...

📊 Step 1: 데이터 수집 중...
  ✅ Drive 파일 위치: 124개
  ✅ Database 분류 정보: 124개
  ✅ Notion Vision 데이터: 124개

🔍 Step 2: 분류 차이 분석 중...
📈 분석 결과:
  - 총 파일: 124개
  - 수정됨: 31개
  - 유지됨: 93개

🧠 Step 3: 패턴 학습 중...

📝 Step 4: 분류 규칙 생성 중...

💾 Step 5: 학습 결과 저장 중...
  ✅ learned-rules.json 저장됨
  ✅ classification-report.json 저장됨

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 학습 결과 요약

캐릭터 일러스트 (단독) (샘플: 13개):
  필수 Labels: animation, character, cartoon
  금지 Labels: screenshot, game, interface, display
  텍스트 있음: 아니오 (평균 길이: 25자)
  권장 Priority: 0.95
  평균 신뢰도: 85%

✅ 학습 완료!
```

**생성된 파일:**
- `data/learned-rules.json`: 학습된 분류 규칙
- `data/classification-report.json`: 상세 학습 리포트

### Step 2: 규칙 적용

```bash
node scripts/apply-learned-rules.js
```

**예상 출력:**
```
📝 분류 규칙 적용 시작...

📖 Step 1: 학습된 규칙 로드 중...
  ✅ learned-rules.json 로드 완료

💾 Step 2: 기존 규칙 백업 중...
  ✅ 백업 완료: classificationRules.js.backup

📄 Step 3: 현재 규칙 파일 읽기...
  ✅ 파일 읽기 완료

🔧 Step 4: 학습된 규칙 적용 중...
  🔧 캐릭터 일러스트 (단독) 업데이트 중...
     ✅ Priority: 0.95, hasText: false
  🔧 게임 스크린샷 업데이트 중...
     ✅ Priority: 0.85, hasText: true

💾 Step 5: 업데이트된 규칙 저장 중...
  ✅ 저장 완료: classificationRules.js

✅ 규칙 적용 완료!
```

**변경된 파일:**
- `services/helpers/classificationRules.js`: 업데이트됨
- `services/helpers/classificationRules.js.backup`: 백업 생성

---

## 검증 및 재분류

### Step 1: 정확도 검증

```bash
node scripts/validate-accuracy.js
```

**예상 출력:**
```
🧪 정확도 검증 시작...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 정확도 검증 결과

전체 정확도: 117/124 (94.4%)

카테고리별 정확도:
  캐릭터 일러스트 (단독):
    45/47 (95.7%) [███████████████████░]
  일러스트 (단체):
    28/30 (93.3%) [██████████████████░░]
  UI / 화면:
    20/22 (90.9%) [██████████████████░░]
  게임 스크린샷:
    24/25 (96.0%) [███████████████████░]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 권장 사항:
  ✅ 정확도가 매우 높습니다! 전체 재분류를 진행하세요.

✅ 검증 완료!
```

**해석:**
- **90% 이상**: 매우 좋음, 재분류 진행
- **75-90%**: 양호, 잘못된 파일 확인 후 진행
- **75% 미만**: 추가 수동 분류 또는 재학습 필요

### Step 2: 전체 재분류 (선택)

정확도가 만족스러우면 전체 파일을 재분류합니다.

```bash
node scripts/classify-all-files.js
```

**주의사항:**
- 이 명령어는 모든 파일을 다시 분류하여 이동합니다
- 수동으로 재분류한 내용이 유지됩니다 (학습된 규칙 적용)
- 실행 전 백업이 있는지 확인하세요

---

## 문제 해결

### 문제 1: "learned-rules.json not found" 오류

**원인**: 학습 스크립트를 실행하지 않았습니다.

**해결:**
```bash
node scripts/learn-from-corrections.js
```

### 문제 2: 정확도가 낮음 (75% 미만)

**원인**: 수동 재분류가 충분하지 않거나 패턴이 복잡합니다.

**해결:**
1. 더 많은 파일을 수동으로 재분류
2. 재학습 실행
3. `data/classification-report.json` 확인하여 문제 패턴 분석

### 문제 3: 규칙 적용 후 문제 발생

**원인**: 학습된 규칙에 오류가 있습니다.

**해결:**
```bash
# 백업에서 복원
cp services/helpers/classificationRules.js.backup services/helpers/classificationRules.js
```

### 문제 4: Drive API 인증 오류

**원인**: OAuth 토큰이 만료되었습니다.

**해결:**
1. 서버 시작: `npm start`
2. 브라우저에서 `http://localhost:3000/oauth/authorize` 접속
3. Google 인증 완료
4. 재시도

### 문제 5: Notion API 오류

**원인**: Notion API 키가 만료되었거나 잘못되었습니다.

**해결:**
`.env` 파일의 `NOTION_API_KEY` 확인 및 업데이트

---

## 추가 팁

### 반복 학습

정확도를 더 높이고 싶다면:

1. 재분류 실행 후 잘못된 파일 다시 수동 수정
2. 학습 스크립트 재실행
3. 이 과정을 정확도가 만족스러울 때까지 반복

### 백업 관리

중요한 시점의 규칙을 백업:

```bash
cp services/helpers/classificationRules.js services/helpers/classificationRules_v2.js
```

### 학습 데이터 확인

상세한 학습 결과 확인:

```bash
cat data/classification-report.json
```

또는 JSON 뷰어에서 열기

---

## 요약

1. ✅ Google Drive에서 파일 수동 재분류
2. ✅ `node scripts/learn-from-corrections.js` - 학습 실행
3. ✅ `node scripts/apply-learned-rules.js` - 규칙 적용
4. ✅ `node scripts/validate-accuracy.js` - 정확도 검증
5. ✅ 만족스러우면 `node scripts/classify-all-files.js` - 전체 재분류

**문제가 있나요?** [문제 해결](#문제-해결) 섹션을 참고하세요.
